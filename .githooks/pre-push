#!/usr/bin/env bash
# ğŸ§© FalconForge Athena JSON Validator Hook
# Prevents malformed JSON from being pushed to main

echo "ğŸ” Running JSON validation on all tracked .json files..."
FAILED=0

# Find and validate every JSON file
for file in $(git diff --cached --name-only --diff-filter=ACM | grep '\.json$'); do
    if ! jq . "$file" >/dev/null 2>&1; then
        echo "âŒ Invalid JSON detected: $file"
        FAILED=1
    else
        echo "âœ… Valid JSON: $file"
    fi
done

if [ "$FAILED" -ne 0 ]; then
    echo "ğŸš« Push blocked â€” fix JSON syntax and retry."
    exit 1
fi

echo "âœ¨ All JSON files valid â€” push allowed."
exit 0

